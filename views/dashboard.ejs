<div class="page-header">
  <h2 class="page-title">Heavy Metal Sampling Map</h2>
  <div class="last-updated">Last updated: <span id="lastUpdated"><%= new Date().toLocaleString() %></span></div>
</div>

<div class="stats-grid">
  <% if (user && user.role === 'master') { %>
    <div class="stat-card blue"><div class="stat-content"><div class="stat-info"><p class="stat-label">Total Cases (All-time)</p><p class="stat-value"><%= stats.totalCases || 0 %></p></div><div class="stat-icon"><i class="fas fa-database"></i></div></div></div>
    <div class="stat-card green"><div class="stat-content"><div class="stat-info"><p class="stat-label">Total Posts</p><p class="stat-value"><%= stats.totalPosts || 0 %></p></div><div class="stat-icon"><i class="fas fa-newspaper"></i></div></div></div>
    <div class="stat-card yellow"><div class="stat-content"><div class="stat-info"><p class="stat-label">Assigned Tasks</p><p class="stat-value"><%= stats.assignedCount || 0 %></p></div><div class="stat-icon"><i class="fas fa-user-check"></i></div></div></div>
    <div class="stat-card orange"><div class="stat-content"><div class="stat-info"><p class="stat-label">Unassigned Tasks</p><p class="stat-value"><%= stats.unassignedCount || 0 %></p></div><div class="stat-icon"><i class="fas fa-user-clock"></i></div></div></div>
  <% } else if (user && user.role === 'official') { %>
    <div class="stat-card blue"><div class="stat-content"><div class="stat-info"><p class="stat-label">Total Cases (All-time)</p><p class="stat-value"><%= stats.totalCases || 0 %></p></div><div class="stat-icon"><i class="fas fa-database"></i></div></div></div>
    <div class="stat-card green"><div class="stat-content"><div class="stat-info"><p class="stat-label">Posts Assigned to You</p><p class="stat-value"><%= stats.assignedToMe || 0 %></p></div><div class="stat-icon"><i class="fas fa-tasks"></i></div></div></div>
  <% } else { %>
    <div class="stat-card blue"><div class="stat-content"><div class="stat-info"><p class="stat-label">Total Cases (All-time)</p><p class="stat-value"><%= stats.totalCases || 0 %></p></div><div class="stat-icon"><i class="fas fa-database"></i></div></div></div>
  <% } %>
</div>

<div class="dashboard-card">
  <h3 class="card-title">Sampling Points</h3>
  <div class="map-controls" style="display:flex;gap:0.5rem;justify-content:flex-end;margin-bottom:0.5rem;align-items:center;">
    <label for="sampleYearSelect">Year:</label>
    <select id="sampleYearSelect" style="padding:0.35rem 0.5rem;border:1px solid #d1d5db;border-radius:0.375rem;background:#fff;"></select>
    <label for="sampleMonthSelect" style="margin-left:0.75rem;">Month:</label>
    <select id="sampleMonthSelect" style="padding:0.35rem 0.5rem;border:1px solid #d1d5db;border-radius:0.375rem;background:#fff;"></select>
  </div>
  <div id="heavyMap" style="width:100%;height:520px;border:1px solid #e5e7eb;border-radius:8px;"></div>
  <div class="map-legend" style="margin-top:0.5rem;display:flex;gap:1rem;align-items:center;">
    <div class="legend-item"><span style="display:inline-block;width:12px;height:12px;background:#DC2626;border-radius:2px;margin-right:6px;"></span>High (>=4 metals exceed)</div>
    <div class="legend-item"><span style="display:inline-block;width:12px;height:12px;background:#F59E0B;border-radius:2px;margin-right:6px;"></span>Medium (2-3)</div>
    <div class="legend-item"><span style="display:inline-block;width:12px;height:12px;background:#10B981;border-radius:2px;margin-right:6px;"></span>Low (1)</div>
    <div class="legend-item"><span style="display:inline-block;width:12px;height:12px;background:#3B82F6;border-radius:2px;margin-right:6px;"></span>Background (0)</div>
  </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="/js/heavy-map.js"></script>