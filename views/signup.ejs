<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaFlow - Create Account</title>
    <link rel="icon" type="image/png" href="/images/logo.png">
    <link rel="stylesheet" href="/css/signup.css">
</head>
<body>
    <!-- Floating water drops -->
    <svg class="water-drop drop1" width="40" height="50" viewBox="0 0 40 50">
        <path d="M20 0C20 0 40 20 40 35C40 42.5 32.5 50 20 50C7.5 50 0 42.5 0 35C0 20 20 0 20 0Z" fill="#2563eb"/>
    </svg>
    <svg class="water-drop drop2" width="30" height="40" viewBox="0 0 30 40">
        <path d="M15 0C15 0 30 15 30 27C30 33.5 23.5 40 15 40C6.5 40 0 33.5 0 27C0 15 15 0 15 0Z" fill="#3b82f6"/>
    </svg>
    <svg class="water-drop drop3" width="35" height="45" viewBox="0 0 35 45">
        <path d="M17.5 0C17.5 0 35 17.5 35 31C35 38.5 30.5 45 17.5 45C4.5 45 0 38.5 0 31C0 17.5 17.5 0 17.5 0Z" fill="#60a5fa"/>
    </svg>
    <svg class="water-drop drop4" width="25" height="35" viewBox="0 0 25 35">
        <path d="M12.5 0C12.5 0 25 12.5 25 22C25 28.5 19.5 35 12.5 35C5.5 35 0 28.5 0 22C0 12.5 12.5 0 12.5 0Z" fill="#2563eb"/>
    </svg>
    <svg class="water-drop drop5" width="32" height="42" viewBox="0 0 32 42">
        <path d="M16 0C16 0 32 16 32 28C32 35.5 25.5 42 16 42C6.5 42 0 35.5 0 28C0 16 16 0 16 0Z" fill="#3b82f6"/>
    </svg>
    <svg class="water-drop drop6" width="28" height="38" viewBox="0 0 28 38">
        <path d="M14 0C14 0 28 14 28 26C28 32.5 22.5 38 14 38C5.5 38 0 32.5 0 26C0 14 14 0 14 0Z" fill="#60a5fa"/>
    </svg>

    <div class="signup-container">
        <div class="logo-section">
            <div class="logo-icon">
                <img width = "100vw" src="/images/logo.png" alt="">
            </div>
            <div class="logo-text">AquaFlow</div>
            <div class="logo-subtitle">Disease Prediction System</div>
            <div class="page-title">Create Your Account</div>
        </div>

        <div class="success-message" id="successMessage">
            Account created successfully! Please check your mobile/email for verification.
        </div>

        <div class="user-type-selector">
            <div class="user-type-title">Select Account Type</div>
            <div class="user-type-buttons">
                <button type="button" class="user-type-btn active" id="publicBtn" onclick="selectUserType('public')">
                    General Public
                </button>
                <button type="button" class="user-type-btn" id="govBtn" onclick="selectUserType('government')">
                    Government Body
                </button>
            </div>
        </div>

        <form id="signupForm" method="POST" action="/signup">
            <input type="hidden" id="userType" name="userType" value="public">
            <!-- General Public Form -->
            <div class="form-section active" id="publicForm">
                <div class="otp-info">
                    üì± You will receive an OTP on your mobile number for login verification
                </div>
                
                <div class="form-group">
                    <label class="form-label required" for="publicFullName">Full Name</label>
                    <input type="text" id="publicFullName" name="fullName" class="form-input" placeholder="Enter your full name" required>
                    <div class="error-message" id="publicFullNameError">Please enter your full name</div>
                </div>

                <div class="form-group">
                    <label class="form-label required" for="publicMobile">Mobile Number</label>
                    <input type="tel" id="publicMobile" name="mobile" class="form-input" placeholder="Enter 10-digit mobile number" required>
                    <div class="error-message" id="publicMobileError">Please enter a valid 10-digit mobile number</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="publicEmail">Email Address</label>
                    <input type="email" id="publicEmail" name="email" class="form-input" placeholder="Enter your email (optional)">
                    <div class="error-message" id="publicEmailError">Please enter a valid email address</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required" for="publicState">State</label>
                        <select id="publicState" name="state" class="form-select" required onchange="updateDistricts('public')">
                            <option value="">Select State</option>
                            <option value="west-bengal">West Bengal</option>
                            <option value="uttar-pradesh">Uttar Pradesh</option>
                            <option value="maharashtra">Maharashtra</option>
                            <option value="gujarat">Gujarat</option>
                            <option value="rajasthan">Rajasthan</option>
                        </select>
                        <div class="error-message" id="publicStateError">Please select your state</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="publicDistrict">District</label>
                        <select id="publicDistrict" name="district" class="form-select" required>
                            <option value="">Select District</option>
                        </select>
                        <div class="error-message" id="publicDistrictError">Please select your district</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required" for="publicVillage">Village/Area</label>
                    <select id="publicVillage" name="village" class="form-select" required>
                        <option value="">Select Village/Area</option>
                    </select>
                    <div class="error-message" id="publicVillageError">Please select your village/area</div>
                </div>

               <div class="form-group">
                    <label class="form-label required" for="publicPassword">Password</label>
                    <input type="password" id="publicPassword" name="password" class="form-input" placeholder="Create a strong password" required>
                    <div class="password-strength" id="publicPasswordStrength"></div>
                    <div class="error-message" id="publicPasswordError">Password must be at least 8 characters with uppercase, lowercase, number and special character</div>
                </div>

                <div class="form-group">
                    <label class="form-label required" for="publicConfirmPassword">Confirm Password</label>
                    <input type="password" id="publicConfirmPassword" name="confirmPassword" class="form-input" placeholder="Confirm your password" required>
                    <div class="error-message" id="publicConfirmPasswordError">Passwords do not match</div>
                </div>
            </div>

            <!-- Government Body Form -->
            <div class="form-section" id="govForm">
                <div class="info-message">
                    üèõÔ∏è Create a Government Body account. You will receive a GOV-prefixed ID automatically.
                </div>
                <div class="form-group">
                    <label class="form-label required" for="govEmail">Official Email</label>
                    <input type="email" id="govEmail" name="email" class="form-input" placeholder="Enter official email">
                    <div class="error-message" id="govEmailError">Please enter a valid email</div>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="govMobile">Mobile Number</label>
                    <input type="tel" id="govMobile" name="mobile" class="form-input" placeholder="Enter 10-digit mobile">
                    <div class="error-message" id="govMobileError">Enter a valid 10-digit mobile starting with 6-9</div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label required" for="govState">State</label>
                        <select id="govState" name="state" class="form-select" onchange="updateDistricts('gov')">
                            <option value="">Select State</option>
                            <option value="west-bengal">West Bengal</option>
                            <option value="uttar-pradesh">Uttar Pradesh</option>
                            <option value="maharashtra">Maharashtra</option>
                            <option value="gujarat">Gujarat</option>
                            <option value="rajasthan">Rajasthan</option>
                        </select>
                        <div class="error-message" id="govStateError">Please select state</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label required" for="govDistrict">District</label>
                        <select id="govDistrict" name="district" class="form-select">
                            <option value="">Select District</option>
                        </select>
                        <div class="error-message" id="govDistrictError">Please select district</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="govPassword">Password</label>
                    <input type="password" id="govPassword" name="password" class="form-input" placeholder="Create a strong password">
                    <div class="error-message" id="govPasswordError">Password must be at least 8 characters with uppercase, lowercase, number and special character</div>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="govConfirmPassword">Confirm Password</label>
                    <input type="password" id="govConfirmPassword" name="confirmPassword" class="form-input" placeholder="Confirm your password">
                    <div class="error-message" id="govConfirmPasswordError">Passwords do not match</div>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="terms" name="terms" class="checkbox-input" required>
                <label class="checkbox-label" for="terms">
                    I agree to the <a href="#" onclick="showModal('Terms of Service')">Terms of Service</a> 
                    and <a href="#" onclick="showModal('Privacy Policy')">Privacy Policy</a>
                </label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="newsletter" name="newsletter" class="checkbox-input">
                <label class="checkbox-label" for="newsletter">
                    I would like to receive updates and notifications about AquaFlow services
                </label>
            </div>

            <button type="submit" class="signup-btn" id="signupBtn">
                Create Account
            </button>
        </form>

        <div class="login-link">
            Already have an account? <a href="#" onclick="goToLogin()">Sign In</a>
        </div>
    </div>

    <script>
        // Minimal JS required for functionality and submission
        let currentUserType = 'public';

        const stateDistrictData = {
            'west-bengal': ['Kolkata', 'Howrah', 'North 24 Parganas', 'South 24 Parganas', 'Hooghly', 'Bardhaman', 'Nadia', 'Murshidabad'],
            'uttar-pradesh': ['Lucknow', 'Kanpur Nagar', 'Agra', 'Varanasi', 'Meerut', 'Allahabad', 'Bareilly', 'Moradabad'],
            'maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Thane', 'Nashik', 'Aurangabad', 'Solapur', 'Amravati'],
            'gujarat': ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Bhavnagar', 'Jamnagar', 'Gandhinagar', 'Anand'],
            'rajasthan': ['Jaipur', 'Jodhpur', 'Udaipur', 'Kota', 'Bikaner', 'Ajmer', 'Alwar', 'Bharatpur']
        };

        function toggleSectionEnablement() {
            const publicInputs = document.querySelectorAll('#publicForm input, #publicForm select, #publicForm textarea');
            const govInputs = document.querySelectorAll('#govForm input, #govForm select, #govForm textarea');

            if (currentUserType === 'public') {
                publicInputs.forEach(el => el.disabled = false);
                govInputs.forEach(el => el.disabled = true);
            } else {
                publicInputs.forEach(el => el.disabled = true);
                govInputs.forEach(el => el.disabled = false);
            }
        }

        function selectUserType(type) {
            currentUserType = type;
            document.getElementById('userType').value = type;

            document.getElementById('publicBtn').classList.toggle('active', type === 'public');
            document.getElementById('govBtn').classList.toggle('active', type === 'government');

            document.getElementById('publicForm').classList.toggle('active', type === 'public');
            document.getElementById('govForm').classList.toggle('active', type === 'government');

            // Reset visible error messages
            document.querySelectorAll('.error-message').forEach(error => error.style.display = 'none');

            toggleSectionEnablement();
        }

        function updateDistricts(userType) {
            const stateSelect = document.getElementById(userType + 'State');
            const districtSelect = document.getElementById(userType + 'District');

            const selectedState = stateSelect.value;
            districtSelect.innerHTML = '<option value="">Select District</option>';

            if (selectedState && stateDistrictData[selectedState]) {
                stateDistrictData[selectedState].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
        }

        function validateForm() {
            let isValid = true;

            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });

            if (currentUserType === 'public') {
                const fullName = document.getElementById('publicFullName').value.trim();
                if (fullName.length < 2) {
                    document.getElementById('publicFullNameError').style.display = 'block';
                    isValid = false;
                }

                const mobile = document.getElementById('publicMobile').value.trim();
                const mobileRegex = /^[6-9]\d{9}$/;
                if (!mobileRegex.test(mobile)) {
                    document.getElementById('publicMobileError').style.display = 'block';
                    isValid = false;
                }

                const email = document.getElementById('publicEmail').value.trim();
                if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    document.getElementById('publicEmailError').style.display = 'block';
                    isValid = false;
                }

                const state = document.getElementById('publicState').value;
                if (!state) {
                    document.getElementById('publicStateError').style.display = 'block';
                    isValid = false;
                }

                const district = document.getElementById('publicDistrict').value;
                if (!district) {
                    document.getElementById('publicDistrictError').style.display = 'block';
                    isValid = false;
                }

                const village = document.getElementById('publicVillage').value;
                if (!village) {
                    document.getElementById('publicVillageError').style.display = 'block';
                    isValid = false;
                }

                const password = document.getElementById('publicPassword').value;
                const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
                if (!strongPasswordRegex.test(password)) {
                    document.getElementById('publicPasswordError').style.display = 'block';
                    isValid = false;
                }

                const confirmPassword = document.getElementById('publicConfirmPassword').value;
                if (password !== confirmPassword) {
                    document.getElementById('publicConfirmPasswordError').style.display = 'block';
                    isValid = false;
                }

            } else {
                const email = document.getElementById('govEmail').value.trim();
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    document.getElementById('govEmailError').style.display = 'block';
                    isValid = false;
                }

                const mobile = document.getElementById('govMobile').value.trim();
                const mobileRegex = /^[6-9]\d{9}$/;
                if (!mobileRegex.test(mobile)) {
                    document.getElementById('govMobileError').style.display = 'block';
                    isValid = false;
                }

                const state = document.getElementById('govState').value;
                if (!state) {
                    document.getElementById('govStateError').style.display = 'block';
                    isValid = false;
                }

                const district = document.getElementById('govDistrict').value;
                if (!district) {
                    document.getElementById('govDistrictError').style.display = 'block';
                    isValid = false;
                }

                const password = document.getElementById('govPassword').value;
                const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
                if (!strongPasswordRegex.test(password)) {
                    document.getElementById('govPasswordError').style.display = 'block';
                    isValid = false;
                }

                const confirmPassword = document.getElementById('govConfirmPassword').value;
                if (password !== confirmPassword) {
                    document.getElementById('govConfirmPasswordError').style.display = 'block';
                    isValid = false;
                }
            }

            if (!document.getElementById('terms').checked) {
                alert('Please accept the Terms of Service and Privacy Policy to continue.');
                isValid = false;
            }

            return isValid;
        }

        function showModal(title) {
            alert(title + ' would be displayed in a modal window.');
        }

        function goToLogin() {
            window.location.href = '/login';
        }

        // Real-time confirm password validation
        document.getElementById('publicConfirmPassword').addEventListener('input', function () {
            const pwd = document.getElementById('publicPassword').value;
            const confirm = this.value;
            const err = document.getElementById('publicConfirmPasswordError');
            err.style.display = (pwd && confirm && pwd !== confirm) ? 'block' : 'none';
        });
        document.getElementById('govConfirmPassword').addEventListener('input', function () {
            const pwd = document.getElementById('govPassword').value;
            const confirm = this.value;
            const err = document.getElementById('govConfirmPasswordError');
            err.style.display = (pwd && confirm && pwd !== confirm) ? 'block' : 'none';
        });

        // Submit: allow default submit if valid; otherwise prevent
        document.getElementById('signupForm').addEventListener('submit', function (e) {
            if (!validateForm()) {
                e.preventDefault();
                return false;
            }
            // Ensure disabled status reflects current selection so inactive inputs are not submitted
            toggleSectionEnablement();
            return true;
        });

        // Initialize
        (function init(){
            selectUserType('public');
            const drops = document.querySelectorAll('.water-drop');
            drops.forEach((drop, index) => { drop.style.animationDelay = `${index * 0.5}s`; });
            toggleSectionEnablement();
        })();
    </script>
</body>
</html>